<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="/WEB-INF/Template4Diagnostic6.xhtml">


	<ui:define name="title">Diagnostic 6 - Consultation ERP</ui:define>

	<ui:define name="head">
		<link href="css/consultationERP.css" rel="stylesheet"
			type="text/css" />
	</ui:define>




	<ui:define name="accordeon1">
		ERP avec des interventions en cours (#{mbArborescenceTravaux.listeERPIntervEnCours.size()})
	</ui:define>

	<ui:define name="arborescence1">
		<h:form>
			<rich:tree id="tree1" nodeType="#{node.type}" var="node"
				value="#{mbArborescenceTravaux.rootNodes1}" toggleType="client"
				selectionType="ajax"
				selectionChangeListener="#{mbArborescenceTravaux.selectionChanged}">
				<rich:treeNode type="typeErp">
                    #{node.name}
                </rich:treeNode>
				<rich:treeNode type="erp">  
                	<h:outputLabel value="#{node.name}" >
                		<f:ajax event="click" 
                				listener="#{mbConsultationERP.clickNode(mbArborescenceTravaux.currentSelection.idERP)}" 
                				render=":toto:lblReponseAjax"/>
                	</h:outputLabel>
                </rich:treeNode>
			</rich:tree> 
		</h:form>
	</ui:define>

	<ui:define name="accordeon2">
		ERP en attente d'intervention (#{mbArborescenceTravaux.listeERPIntervAttente.size()})
	</ui:define>

	<ui:define name="arborescence2">
		<h:form>
			<rich:tree id="tree2" nodeType="#{node.type}" var="node"
				value="#{mbArborescenceTravaux.rootNodes2}" toggleType="client"
				selectionType="ajax"
				selectionChangeListener="#{mbArborescenceTravaux.selectionChanged}">
				<rich:treeNode type="typeErp">
                    #{node.name}
                </rich:treeNode>
				<rich:treeNode type="erp">  
                	<h:outputLabel value="#{node.name}" >
                		<f:ajax event="click" 
                				listener="#{mbConsultationERP.clickNode(mbArborescenceTravaux.currentSelection.idERP)}" 
                				render=":toto:lblReponseAjax"/>
                	</h:outputLabel>
                </rich:treeNode>
			</rich:tree>
		</h:form>
	</ui:define>

	<ui:define name="accordeon3">
		ERP archivés (#{mbArborescenceTravaux.listeERPIntervArchive.size()})
	</ui:define>

	<ui:define name="arborescence3">
		<h:form>
			<rich:tree id="tree3" nodeType="#{node.type}" var="node"
				value="#{mbArborescenceTravaux.rootNodes3}" toggleType="client"
				selectionType="ajax"
				selectionChangeListener="#{mbArborescenceTravaux.selectionChanged}">
				<rich:treeNode type="typeErp">
                    #{node.name}
                </rich:treeNode>
				<rich:treeNode type="erp">  
                	<h:outputLabel value="#{node.name}" >
                		<f:ajax event="click" 
                				listener="#{mbConsultationERP.clickNode(mbArborescenceTravaux.currentSelection.idERP)}" 
                				render=":toto:lblReponseAjax"/>
                	</h:outputLabel>
                </rich:treeNode>
			</rich:tree>
		</h:form>
	</ui:define>


	

	<ui:define name="content">
	
		<f:view>

			<div id="content">
				<h:form id="toto">
 					<f:event listener="#{mbConsultationERP.loadERP()}" type="preRenderView"/> 
					<h:panelGroup id="lblReponseAjax" layout="block" >

						<div class="mini-barreEtat">
							<h2>
								ERP - #{mbConsultationERP.monERP.nomErp}
							</h2>
							
						</div>

						<!-- Section INFORMATIONS ERP -->
						<div id="InfoErpDiagnostic">

							<h3>Informations sur l'ERP</h3>

							<div class="formulaire">
								<h:outputLabel class="intitule" value="ERP concerné : " />
								<h:outputLabel class="valeur"
									value="#{mbConsultationERP.monERP.nomErp}" />

								<h:outputLabel class="intitule" value="Catégorie : " />
								<h:outputLabel class="valeur"
									value="#{mbConsultationERP.monERP.categorieErp.denominationCategorieErp}" />

								<h:outputLabel class="intitule" value="Fonction : " />
								<h:outputLabel class="valeur"
									value="#{mbConsultationERP.monERP.typeErp.denominationTypeErp} #{mbConsultationERP.monERP.typeErp.typeErp}" />

								<h:outputLabel class="intitule" value="Adresse : " />
								<h:outputLabel class="valeur" value="#{mbConsultationERP.monERP.numVoieErp} #{mbConsultationERP.monERP.nomVoieErp} 
								&lt;br /&gt;#{mbConsultationERP.monERP.localisation.codePostal} #{mbConsultationERP.monERP.localisation.ville}" 
								escape="false" />

							</div>
							
							<div class="formulaire">
								
								<h:outputLabel class="intitule" value="Propriétaire : " />
								<h:outputLabel class="valeur"
									value="#{mbConsultationERP.monERP.proprietaire.nomProprietaire.toUpperCase()} #{mbConsultationERP.monERP.proprietaire.prenomProprietaire}" />

								<h:outputLabel class="intitule" value="Coordonnées : " />
								<h:outputLabel class="valeur"
									value="Tél : #{mbConsultationERP.monERP.proprietaire.telProprietaire} 
                        	&lt;br /&gt; Mail : #{mbConsultationERP.monERP.proprietaire.mailProprietaire}
                        	&lt;br /&gt; #{mbConsultationERP.monERP.proprietaire.numVoieProprietaire} #{mbConsultationERP.monERP.proprietaire.nomVoieProprietaire} 
                        	&lt;br /&gt; #{mbConsultationERP.monERP.proprietaire.localisation.codePostal} #{mbConsultationERP.monERP.proprietaire.localisation.ville}"
									escape="false" />
							</div>
							
						</div>

						<!-- Section INFORMATIONS DIAGNOSTICS -->
						<div id="InfoErpDiagnostic">

							<h3>Diagnostics enregistrés sur cet ERP (#{mbConsultationERP.monERP.listeDiagnosticErp.size()})</h3>

							<ui:repeat var="diagnostic"
								value="#{mbConsultationERP.monERP.listeDiagnosticErp}">

								<div class="diagnostic">
									<h:outputLabel class="intitule" value="Titre du diagnostic : " />
									<h:outputLabel class="valeur" value="#{diagnostic.intituleDiagnostic}" />
									
									<h:commandLink action="consultationDiagnostic" value="Lien vers la fiche du diagnostic">
      									<f:param name="id" value="#{diagnostic.idDiagnostic}" />
   									</h:commandLink>
   									
									<h:outputLabel class="intitule"
										value="Nombre d'anomalies : " />										
									<h:outputLabel class="valeur" value="#{diagnostic.listeAnomaliesDiagnostic.size()}" />
									
									<h:outputLabel class="intitule"	value="Type de diagnostic : " />
									<img class="etatTravaux"
										 src="#{mbConsultationERP.typeDiagnostic(diagnostic.typeDiagnostic.idTypeDiagnostic)}"/>
										 
									<h:outputLabel class="intitule"	value="Statut du diagnostic : " />										
									<h:outputLabel class="valeur" value="#{mbConsultationERP.statutTraiteOuNon(diagnostic.traite)}" />

								</div>
							</ui:repeat>
						</div>
						
						<!-- Section INFORMATIONS STRUCTURE -->
						<div id="InfoErpDiagnostic">

							<h3>Structure détaillée de l'ERP</h3>

							<table>
								<tr>
									<th>Batiment</th>									
									<th>Structure</th>									
									<th>Etage si indiqué</th>									
								</tr>
								
								<ui:repeat var="batiment" value="#{mbConsultationERP.monERP.listeBatimentsErp}">
									
									<ui:repeat var="acces" value="#{batiment.listeAccesBatiment}">
									<tr>
										<td>#{batiment.intituleBatiment} #{batiment.numBatiment}</td>
										<td>Accès #{acces.typeAcces.libelleTypeAcces}</td>
										<td></td>
									</tr>
									</ui:repeat>
									
									<ui:repeat var="ascenceur" value="#{batiment.listeAscenceursBatiment}">
									<tr>
										<td>#{batiment.intituleBatiment}</td>
										<td>Ascenceur #{ascenceur.denominationAscenceur}</td>
										<td></td>
									</tr>
									</ui:repeat>
									
									<ui:repeat var="escalier" value="#{batiment.listeEscaliersBatiment}">
									<tr>
										<td>#{batiment.intituleBatiment} #{batiment.numBatiment}</td>
										<td>Escalier #{escalier.denominationEscalier}</td>
										<td></td>
									</tr>
									</ui:repeat>
									
									<ui:repeat var="etage" value="#{batiment.listeEtagesBatiment}">
										<ui:repeat var="piece" value="#{etage.listePieces}">
										<tr>
											<td>#{batiment.intituleBatiment} #{batiment.numBatiment}</td>
											<td>Pièce #{piece.denominationPiece}</td>
											<td>#{etage.nomEtage}</td>
										</tr>
										</ui:repeat>
									</ui:repeat>
									
								</ui:repeat>															
							</table>
							
							<table>
								<tr>
									<th>Voirie</th>
									<th>Type de voirie</th>
									<th>Désignation</th>									
								</tr>
								
								<ui:repeat var="voirie" value="#{mbConsultationERP.monERP.listeVoiriesErp}">
									<tr>
										<td>#{voirie.intituleVoirie}</td>
										<td>#{voirie.typeVoirie.libelleTypeVoirie}</td>
										<td>#{voirie.designationVoirie}</td>
									</tr>
								</ui:repeat>							
							</table>
							
						</div>						
						
					</h:panelGroup>
				</h:form>
			</div>
		</f:view>		
	</ui:define>
</ui:composition>
</html>
