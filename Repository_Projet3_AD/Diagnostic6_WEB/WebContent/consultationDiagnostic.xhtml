<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<h:head>

	<link rel="stylesheet"
		href="//code.jquery.com/ui/1.11.4/themes/flick/jquery-ui.css" />
	<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
	
</h:head>

<ui:composition template="/WEB-INF/Template2Diagnostic6.xhtml">
	<ui:define name="title">Diagnostic 6 - Consultation diagnostic</ui:define>
	<ui:define name="head">
	<link href="css/consultationDiagnostic.css" rel="stylesheet" type="text/css" />
	</ui:define>
	<ui:define name="content">
<f:view>
		
		<div id="content">
			<h:form>
		<h:inputText value="#{mbDonneesGenerales.idDiag}" />
				<a4j:commandLink 
					value="Recuperer diagnostic"
					action="#{mbDonneesGenerales.recupererDiagnostic()}" 
					render="lblReponseAjax" />
		
			<h:panelGroup id="lblReponseAjax" layout="block">
		
			<div class="mini-barreEtat">
				<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.intituleDiagnostic}"/>
				<div id="mini-barreEtat-boutons">
					<a href=""><img class="boutons-mini-barreEtat"
						id="boutonModifier" name="boutonModifier"
						src="images/consultationDiagnostic/DiagnosticBoutonModifier.26.26.png" /></a>

					<a href=""><img class="boutons-mini-barreEtat"
						id="notificationGrisee" name="notificationG"
						src="images/consultationDiagnostic/NotificationIconeDiagGrise.26.26.nette.png"
						onClick="notification(this.src)" /></a> <a href=""><img
						class="boutons-mini-barreEtat" id="notificationRouge"
						name="notificationR"
						src="images/consultationDiagnostic/NotifIconeDiagRouge.26.26.png"
						onClick="denotification(this.src)" /></a> <a href=""><img
						class="boutons-mini-barreEtat" id="favoritesGrisee"
						name="favorite"
						src="images/consultationDiagnostic/NoFavoritesIcon.26.26.png"
						onClick="favorisation(this.src)" /></a> <a href=""><img
						class="boutons-mini-barreEtat" id="favoriteJaune" name="favorite"
						src="images/consultationDiagnostic/FavoriteIcon.26.26.png"
						onClick="defavorisation(this.src)" /></a>
				</div>
			</div>
			<div id="InfoErpDiagnostic">
				<div id="ErpDiagGeneral">
					<div id="ErpDiagTitre">
						<h3>
							<span>Informations générales</span>
						</h3>
					</div>
					<div class="tableErpDiagGeneral">
					<rich:panel style="width:99.5%; background-color:#f7f7f7;border:none;">
                        <h:panelGrid columns="2" style="float:left;" >
                        	<h:outputText value="ERP concerné : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.erp.nomErp}" />
                        	<h:outputText value="Catégorie : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.erp.categorieErp.denominationCategorieErp}" />
                        	<h:outputText value="Fonction : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.erp.typeErp.denominationTypeErp} #{mbDonneesGenerales.diagnosticSelectionne.erp.typeErp.typeErp}" />	
                        	<h:outputText value="Adresse : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.erp.numVoieErp} #{mbDonneesGenerales.diagnosticSelectionne.erp.nomVoieErp}"/>
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.erp.localisation.codePostal} #{mbDonneesGenerales.diagnosticSelectionne.erp.localisation.ville}" />
                        	<h:outputText value="Propriétaire ? " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.erp.localisation.codePostal} #{mbDonneesGenerales.diagnosticSelectionne.erp.localisation.ville}" />
                        </h:panelGrid>
                        <h:panelGrid columns="2">
                        	<h:outputText value="Etat diagnostic : " />
                        	<h:outputText value="#{mbDonneesGenerales.traiteDiagnostic()}"/>
                        	<h:outputText value="Date de réalisation du diagnostic : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.dateRealisationDiagnostic.toLocaleString()}"/>
                        	<h:outputText value="Date d'enregistrement diagnostic : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.dateSaisieDiagnostic.toLocaleString()}" />
                        	<h:outputText value="Expert : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.expert.prenomExpert} #{mbDonneesGenerales.diagnosticSelectionne.expert.nomExpert}"/>
                        	<h:outputText value="Coordonées : " />
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.expert.telExpert}"/>
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.expert.mailExpert}"/>
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.expert.numVoieExpert} #{mbDonneesGenerales.diagnosticSelectionne.expert.nomVoieExpert}"/>
                        	<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.expert.localisation.codePostal} #{mbDonneesGenerales.diagnosticSelectionne.expert.localisation.ville}"/>
                        </h:panelGrid>
                    </rich:panel>
		
					</div>
				</div>
				<div id="infoDetaille">
					<div id="buttShowEDD">
						<h3>
							<span>Informations détaillées</span>
						</h3>
					</div>

					<div id="ErpDiagDetaille">
						<div id="nbBatimentErp">
							<span>Nombres de bâtiments constituant l'ERP : </span><span
								id="nbBatimentErpRecherche"><h:outputText value="#{mbDonneesGenerales.erpSelectionne.listeBatimentsErp.size()}" /></span>
						</div>
						<div class="tableErpDetaille">
						
						<h:panelGrid columns="1">
           			 	<a4j:outputPanel id="panel" layout="block">
               			<a4j:repeat value="#{mbDonneesGenerales.erpSelectionne.listeBatimentsErp}" var="o" rows="20" id="repeat">
                    	<rich:panel style="float:left; width:300px; padding:1px; background-color:#f7f7f7; border-display:none;  ">
                      		<h:outputText value="Intitulé : " style="font-weight:bold" />
                           	<h:outputText value="#{o.intituleBatiment}" style="font-weight:bold" />
                        	<h:panelGrid columns="2">
                            	
                            	<h:outputText value="Nombre d'étages : " style="font-weight:bold" />
                            	<h:outputText value="#{o.listeEtagesBatiment.size()}" />
                            	<h:outputText value="Nombre de pièces : " style="font-weight:bold" />
                            	<h:outputText value="#{mbDonneesGenerales.calculNbPiecesBat()}" id="nbPieces"  /> 
                            	<h:outputText value="Nombre d'accès : " style="font-weight:bold" />
                            	<h:outputText value="#{o.listeAccesBatiment.size()}" />
                            	<h:outputText value="Nombre d'escaliers : " style="font-weight:bold" />
                            	<h:outputText value="#{o.listeEscaliersBatiment.size()}" />
                            	<h:outputText value="Nombre d'ascenseurs : " style="font-weight:bold" />
                            	<h:outputText value="#{o.listeAscenceursBatiment.size()}" />
                        	</h:panelGrid>
                    	</rich:panel>
                		</a4j:repeat>
           				</a4j:outputPanel>
       				 	</h:panelGrid>
							
						</div>
						
						<!-- ce bloc sera pas ajouté car il n'y a pas d'intérêt à afficher tous les TYPES des pièces exitents dans le batiment. Eventuellement completer l'affichage actuel avec d'autres informations, mais l'interface graphique est à définir. -->
						
						<ui:repeat var="o" value="#{order.orderList}" varStatus="status">
							<div id="foncPiecesErp">
								<span> Fonctions des pièces dont dispose le batiment : </span><span
									id="batIntileErp">#{o.intituleBatiment}</span>
								<table id="tableFoncPiecesErp">
									<ui:repeat var="o" value="#{order.orderList}"
										varStatus="status">
										<tr>
											<th id="nbPiecesBatErp" class="ErpDetaille" width="20px"
												style="text-align: right">#Résultat de Recherche#</th>
											<th id="foncPiecesBatErp" class="ErpDetaille" width="160px"
												style="text-align: right">#{o.libelleFonctionPiece}</th>
										</tr>
									</ui:repeat>
								
								</table>
							</div>
						</ui:repeat>
					</div>
				</div>
			</div>
			
			<div id="diagAnomalieSection">
				<div id="diagnosticFiche">
					<div id="ficheDiagTitre">
						<h3>
							<span>Diagnostic portant sur </span>
							<h:outputText value="#{mbDonneesGenerales.diagnosticSelectionne.typeDiagnostic.nomType}" />
						</h3>
						<a href=""><img class="ficheDiagTitreImage"
							id="boutonModifier"
							src="images/TypesDiagnosticIcones/TypeAcces.75.71.png" /></a>
					</div>
					<div id="ficheAnomTitre">
						<h3>
							<span>Nombre d'anomalies recencées : </span>
							<h:outputText value="#{mbDonneesGenerales.listeAnomaliesParDiagnostic.size()}" id="nbAnomalies"  /> 
						</h3>
					</div> 
				</div>
				<div id="anomaliesFiche">
       									<h:panelGrid columns="1">
           			 	<h:panelGroup id="panel2" layout="block">
               			
               			<ui:repeat value="#{mbDonneesGenerales.diagnosticSelectionne.listeAnomaliesDiagnostic}" var="o" rows="20" id="repeatAnomalies">
                    	<rich:panel style="float:left; width:97.5%; background-color:#f7f7f7; border-display:none;  ">
                       		
                        	<h:panelGrid columns="2">
                        		<h:outputText value="Anomalie n° : " style="font-weight:bold" /> 
                            	<h:outputText value="#{o.idAnomalie}" style="font-weight:bold; border:none; font-color:black" id="idAnom"/>
                           		<h:outputText value="Etat anomalie : " style="font-weight:bold "  />
                           		<h:outputText value="#{mbDonneesGenerales.traiteAnomalie(o)}" disabled="#{mbDonneesGenerales.isEnable(o)}" />
                            	<h:outputText value="Niveau indicateur : " style="font-weight:bold" />
                            	<h:selectOneMenu value="#{o.indicateur.idIndicateur}">
                            		<f:selectItems value="#{mbDonneesGenerales.listeIndicateursParDiagnostic}" var = "ind"
                            						itemLabel="#{ind.libelleIndicateur}"
                            						itemValue="#{ind.idIndicateur}" noSelectionValue="#{o.indicateur.idIndicateur}" ></f:selectItems>
                            		<f:attribute name="disabled" value="#{mbDonneesGenerales.isEnable(o)}"></f:attribute>
                            	</h:selectOneMenu>
                            	<h:outputText value="Localisation : " style="font-weight:bold" />
                            	<h:outputText value="#{mbDonneesGenerales.localisationAnomalie(o)}" />
                            	<h:outputText value="Description : " style="font-weight:bold" />
                            	<h:inputText value="#{o.descriptionAnomalie}" class="inputTextAnomalieDisabled">
                            		<f:attribute name="disabled" value="#{mbDonneesGenerales.isEnable(o)}"></f:attribute>
                            	</h:inputText>
                            	<h:outputText value="Preconisation :" style="font-weight:bold" />
                            	<h:inputText value="#{o.preconisationAnomalie}" class="inputTextAnomalieDisabled">
                            		<f:attribute name="disabled" value="#{mbDonneesGenerales.isEnable(o)}"></f:attribute>
                            	</h:inputText>
                            	<h:outputText value="Coût estimé :" style="font-weight:bold" />
                            	<h:inputText value="#{o.coutEstimeAnomalie}"   class="inputTextAnomalieDisabled">
                            		<f:attribute name="disabled" value="#{mbDonneesGenerales.isEnable(o)}"></f:attribute>
                            	</h:inputText>
                            	<h:outputText value="Intervention :" style="font-weight:bold" />
                            	<h:outputText value="#{mbDonneesGenerales.recupererEtatIntervention(o)}" disabled="true" class="inputTextAnomalieDisabled"/>
                            	<h:commandButton action="#{mbDonneesGenerales.modificationAnomalie(o)}" value="#{mbDonneesGenerales.clickChangeBouton(o)}" id="modifAnom" > 
                            	</h:commandButton>
                            	<h:commandButton action="#{mbDonneesGenerales.annulerModifAnomalie(o)}"  value="Annuler modification" id="annulModif" >
                            		<f:attribute name="disabled" value="#{mbDonneesGenerales.isEnable(o)}"></f:attribute>
                            	</h:commandButton>
                            	<h:commandButton action="#{mbDonneesGenerales.suppressionAnomalie(o)}" value="Suppression anomalie" />
                        	</h:panelGrid>
                        	
                    	</rich:panel>
                		</ui:repeat>
                		
           				</h:panelGroup>
       				 	</h:panelGrid>
				</div>
			</div>		
			</h:panelGroup>	
			</h:form>
		</div>

<script>
		jQuery.noConflict();
		
		$( "#radio" ).buttonset();
		$( "#accordion" ).accordion();
		$("button").button();

		$( "#buttShowEDD" ).click(function() {
			$( "#ErpDiagDetaille" ).toggle( "blind", 500 );
		});
 
	

  function notification() 
  { 
	  $( "#notificationGrisee" ).toggle();
	  $( "#notificationRouge" ).toggle();
	  	document.getElementById(notificationGrisee).src = url;
  }
  function denotification() 
  { 
	  $( "#notificationRouge" ).toggle();
	  $( "#notificationGrisee" ).toggle();
	  	document.getElementById(notificationRouge).src = url;
  }
  function favorisation() 
  { 
	  $( "#favoritesGrisee" ).toggle();
	  $( "#favoriteJaune" ).toggle();
	  document.getElementById(favoritesGrisee).src = url;
  }
  function defavorisation() 
  { 
	  $( "#favoriteJaune" ).toggle();
	  $( "#favoritesGrisee" ).toggle();
	  document.getElementById(favoriteJaune).src = url;
  }
	
</script>
</f:view>
	</ui:define>
</ui:composition>
</html>