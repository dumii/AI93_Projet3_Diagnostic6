<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich">

<ui:composition template="/WEB-INF/Template5Diagnostic6.xhtml">

	<ui:define name="title">Diagnostic 6 - Consultation intervention</ui:define>

	<ui:define name="head">
		<link href="css/historiqueTravaux.css" rel="stylesheet"
			type="text/css" />
	</ui:define>




	<ui:define name="accordeon1">
		ERP avec des interventions en cours (#{mbArborescenceTravaux.listeERPIntervEnCours.size()})
	</ui:define>

	<ui:define name="arborescence1">
		<h:form>
			<rich:tree id="tree1" nodeType="#{node.type}" var="node"
				value="#{mbArborescenceTravaux.rootNodes1}" toggleType="client"
				selectionType="ajax"
				selectionChangeListener="#{mbArborescenceTravaux.selectionChanged}">
				<rich:treeNode type="typeErp">
                    #{node.name}
                </rich:treeNode>
				<rich:treeNode type="erp">
					<h:commandLink action="consultationTravaux" value="#{node.name}">
      					<f:param name="id" value="#{mbArborescenceTravaux.currentSelection.idERP}" />
   					</h:commandLink>        
                </rich:treeNode>
			</rich:tree>
		</h:form>
	</ui:define>

	<ui:define name="accordeon2">
		ERP en attente d'intervention (#{mbArborescenceTravaux.listeERPIntervAttente.size()})
	</ui:define>

	<ui:define name="arborescence2">
		<h:form>
			<rich:tree id="tree2" nodeType="#{node.type}" var="node"
				value="#{mbArborescenceTravaux.rootNodes2}" toggleType="client"
				selectionType="ajax"
				selectionChangeListener="#{mbArborescenceTravaux.selectionChanged}">
				<rich:treeNode type="typeErp">
                    #{node.name}
                </rich:treeNode>
				<rich:treeNode type="erp">
					<h:commandLink action="consultationTravaux" value="#{node.name}">
      					<f:param name="id" value="#{mbArborescenceTravaux.currentSelection.idERP}" />
   					</h:commandLink>        
                </rich:treeNode>>
			</rich:tree>
		</h:form>
	</ui:define>

	<ui:define name="accordeon3">
		ERP archivés (#{mbArborescenceTravaux.listeERPIntervArchive.size()})
	</ui:define>

	<ui:define name="arborescence3">
		<h:form>
			<rich:tree id="tree3" nodeType="#{node.type}" var="node"
				value="#{mbArborescenceTravaux.rootNodes3}" toggleType="client"
				selectionType="ajax"
				selectionChangeListener="#{mbArborescenceTravaux.selectionChanged}">
				<rich:treeNode type="typeErp">
                    #{node.name}
                </rich:treeNode>
				<rich:treeNode type="erp">
					<h:commandLink action="consultationTravaux" value="#{node.name}">
      					<f:param name="id" value="#{mbArborescenceTravaux.currentSelection.idERP}" />
   					</h:commandLink>        
                </rich:treeNode>
			</rich:tree>
		</h:form>
	</ui:define>


	<ui:define name="content">
	<f:event listener="#{mbHistoriqueTravaux.loadHistorique()}" type="preRenderView"/>
		<div id="content">
			<h:form>
				<div id="InfoErpDiagnostic">

					<h3>Historique des interventions - #{mbHistoriqueTravaux.monERP.nomErp}</h3>

					<table>
						<tr>
							<th>Date de modification</th>
							<th>Type de modification</th>
							<th>Nouvelles données</th>
							<th>Anciennes données</th>
							<th>Auteur</th>
						</tr>
						<ui:repeat var="histoInt"
							value="#{mbHistoriqueTravaux.listeInterventions}"
							varStatus="status">

							<tr>
								<td>#{histoInt.dateModification}</td>
								<td>#{histoInt.typeModification}</td>
								<td>#{histoInt.nouvelleDonnee}</td>
								<td>#{histoInt.ancienneDonnee}</td>
								<td>#{histoInt.utilisateur.nomUtilisateur}</td>
							</tr>

						</ui:repeat>

					</table>

				</div>
			</h:form>	
		</div>
	</ui:define>

</ui:composition>
</html>
